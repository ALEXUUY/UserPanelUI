<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پروفایل کاربری - پنل مدیریت کسب‌وکار</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Desktop Sidebar -->
        <nav class="sidebar d-none d-md-block">
            <div class="sidebar-header">
                <h4><i class="fas fa-rocket me-2"></i>پنل کسب‌وکار</h4>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html"><i class="fas fa-home"></i>داشبورد</a></li>
                <li><a href="website-creation.html"><i class="fas fa-globe"></i>ایجاد سایت</a></li>
                <li><a href="advertising.html"><i class="fas fa-dollar-sign"></i>تبلیغات</a></li>
                <li><a href="marketing.html"><i class="fas fa-chart-line"></i>بازاریابی</a></li>
                <li><a href="affiliate.html"><i class="fas fa-users"></i>زیرمجموعه‌گیری</a></li>
                <li><a href="publishing.html"><i class="fas fa-book"></i>انتشار کتاب</a></li>
                <li><a href="profile.html" class="active"><i class="fas fa-user"></i>پروفایل</a></li>
                <li><a href="support.html"><i class="fas fa-headset"></i>پشتیبانی</a></li>
                <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i>خروج</a></li>
            </ul>
        </nav>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-nav d-md-none">
            <a href="dashboard.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>خانه</span>
            </a>
            <a href="website-creation.html" class="nav-item">
                <i class="fas fa-globe"></i>
                <span>سایت</span>
            </a>
            <a href="marketing.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>بازاریابی</span>
            </a>
            <a href="profile.html" class="nav-item active">
                <i class="fas fa-user"></i>
                <span>پروفایل</span>
            </a>
            <a href="#" class="nav-item" onclick="showMobileMenu()">
                <i class="fas fa-bars"></i>
                <span>منو</span>
            </a>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header mb-4">
                <h2><i class="fas fa-user me-2"></i>پروفایل کاربری</h2>
                <p class="text-muted">مدیریت اطلاعات شخصی و تنظیمات حساب</p>
            </header>

            <!-- Profile Header -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <img id="profileImage" src="https://via.placeholder.com/120/007bff/ffffff?text=User" alt="Profile" class="rounded-circle">
                            <div class="avatar-upload">
                                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                <button class="btn btn-sm btn-primary" onclick="document.getElementById('avatarInput').click()">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        <div class="profile-info">
                            <h4 id="profileName">نام کاربر</h4>
                            <p class="text-muted" id="profileEmail">email@example.com</p>
                            <div class="profile-stats">
                                <span class="badge bg-primary me-2">عضویت: <span id="memberSince"></span></span>
                                <span class="badge bg-success">کاربر فعال</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tabs -->
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="profileTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal" type="button">
                                <i class="fas fa-user me-2"></i>اطلاعات شخصی
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button">
                                <i class="fas fa-shield-alt me-2"></i>امنیت
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button">
                                <i class="fas fa-bell me-2"></i>اعلان‌ها
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#business" type="button">
                                <i class="fas fa-briefcase me-2"></i>اطلاعات کسب‌وکار
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="profileTabsContent">
                        <!-- Personal Information Tab -->
                        <div class="tab-pane fade show active" id="personal" role="tabpanel">
                            <form id="personalInfoForm">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">نام و نام خانوادگی</label>
                                        <input type="text" class="form-control" id="fullName" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ایمیل</label>
                                        <input type="email" class="form-control" id="email" readonly>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">شماره موبایل</label>
                                        <input type="tel" class="form-control" id="phone">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">تاریخ تولد</label>
                                        <input type="date" class="form-control" id="birthDate">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">جنسیت</label>
                                        <select class="form-select" id="gender">
                                            <option value="">انتخاب کنید</option>
                                            <option value="male">مرد</option>
                                            <option value="female">زن</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">استان</label>
                                        <select class="form-select" id="province">
                                            <option value="">انتخاب کنید</option>
                                            <option value="tehran">تهران</option>
                                            <option value="isfahan">اصفهان</option>
                                            <option value="shiraz">شیراز</option>
                                            <option value="mashhad">مشهد</option>
                                            <option value="tabriz">تبریز</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">آدرس</label>
                                        <textarea class="form-control" id="address" rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>ذخیره تغییرات
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Security Tab -->
                        <div class="tab-pane fade" id="security" role="tabpanel">
                            <div class="security-section">
                                <h5>تغییر رمز عبور</h5>
                                <form id="passwordChangeForm">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">رمز عبور فعلی</label>
                                            <input type="password" class="form-control" id="currentPassword" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">رمز عبور جدید</label>
                                            <input type="password" class="form-control" id="newPassword" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">تکرار رمز عبور جدید</label>
                                            <input type="password" class="form-control" id="confirmNewPassword" required>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button type="submit" class="btn btn-warning">
                                            <i class="fas fa-key me-2"></i>تغییر رمز عبور
                                        </button>
                                    </div>
                                </form>

                                <hr class="my-4">

                                <h5>احراز هویت دو مرحله‌ای</h5>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <p class="mb-1">افزایش امنیت حساب با احراز هویت دو مرحله‌ای</p>
                                        <small class="text-muted">وضعیت فعلی: غیرفعال</small>
                                    </div>
                                    <button class="btn btn-outline-primary" onclick="enable2FA()">
                                        فعال‌سازی
                                    </button>
                                </div>

                                <hr class="my-4">

                                <h5>جلسات فعال</h5>
                                <div class="active-sessions">
                                    <div class="session-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <p class="mb-1"><i class="fas fa-desktop me-2"></i>دسکتاپ - Chrome</p>
                                                <small class="text-muted">آخرین فعالیت: اکنون</small>
                                            </div>
                                            <span class="badge bg-success">فعلی</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Tab -->
                        <div class="tab-pane fade" id="notifications" role="tabpanel">
                            <form id="notificationSettings">
                                <h5>تنظیمات اعلان‌ها</h5>
                                
                                <div class="notification-group">
                                    <h6>اعلان‌های ایمیل</h6>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="emailOrders" checked>
                                        <label class="form-check-label" for="emailOrders">سفارش‌های جدید</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="emailMarketing" checked>
                                        <label class="form-check-label" for="emailMarketing">آپدیت‌های بازاریابی</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="emailNews">
                                        <label class="form-check-label" for="emailNews">خبرنامه</label>
                                    </div>
                                </div>

                                <div class="notification-group">
                                    <h6>اعلان‌های SMS</h6>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="smsImportant" checked>
                                        <label class="form-check-label" for="smsImportant">اعلان‌های مهم</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="smsPayments" checked>
                                        <label class="form-check-label" for="smsPayments">تأیید پرداخت‌ها</label>
                                    </div>
                                </div>

                                <div class="mt-3">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>ذخیره تنظیمات
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Business Information Tab -->
                        <div class="tab-pane fade" id="business" role="tabpanel">
                            <form id="businessInfoForm">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">نام کسب‌وکار</label>
                                        <input type="text" class="form-control" id="businessName">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">نوع فعالیت</label>
                                        <select class="form-select" id="businessType">
                                            <option value="">انتخاب کنید</option>
                                            <option value="retail">خرده‌فروشی</option>
                                            <option value="service">خدماتی</option>
                                            <option value="manufacturing">تولیدی</option>
                                            <option value="consulting">مشاوره</option>
                                            <option value="online">آنلاین</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">شماره ثبت</label>
                                        <input type="text" class="form-control" id="registrationNumber">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">کد اقتصادی</label>
                                        <input type="text" class="form-control" id="economicCode">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">آدرس کسب‌وکار</label>
                                        <textarea class="form-control" id="businessAddress" rows="3"></textarea>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">تلفن کسب‌وکار</label>
                                        <input type="tel" class="form-control" id="businessPhone">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">وب‌سایت</label>
                                        <input type="url" class="form-control" id="businessWebsite">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>ذخیره اطلاعات کسب‌وکار
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Check authentication
        if (!Auth.isLoggedIn()) {
            window.location.href = 'login.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
        });

        function loadUserProfile() {
            const user = Auth.getCurrentUser();
            const profile = Storage.get('userProfile') || {};

            // Load basic info
            document.getElementById('profileName').textContent = user.name;
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('memberSince').textContent = user.createdAt || 'نامشخص';

            // Load personal info
            document.getElementById('fullName').value = profile.fullName || user.name;
            document.getElementById('email').value = user.email;
            document.getElementById('phone').value = profile.phone || user.phone || '';
            document.getElementById('birthDate').value = profile.birthDate || '';
            document.getElementById('gender').value = profile.gender || '';
            document.getElementById('province').value = profile.province || '';
            document.getElementById('address').value = profile.address || '';

            // Load business info
            document.getElementById('businessName').value = profile.businessName || '';
            document.getElementById('businessType').value = profile.businessType || '';
            document.getElementById('registrationNumber').value = profile.registrationNumber || '';
            document.getElementById('economicCode').value = profile.economicCode || '';
            document.getElementById('businessAddress').value = profile.businessAddress || '';
            document.getElementById('businessPhone').value = profile.businessPhone || '';
            document.getElementById('businessWebsite').value = profile.businessWebsite || '';

            // Load notification settings
            const notifications = Storage.get('notificationSettings') || {};
            document.getElementById('emailOrders').checked = notifications.emailOrders !== false;
            document.getElementById('emailMarketing').checked = notifications.emailMarketing !== false;
            document.getElementById('emailNews').checked = notifications.emailNews === true;
            document.getElementById('smsImportant').checked = notifications.smsImportant !== false;
            document.getElementById('smsPayments').checked = notifications.smsPayments !== false;
        }

        // Personal Info Form
        document.getElementById('personalInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const profile = Storage.get('userProfile') || {};
            profile.fullName = document.getElementById('fullName').value;
            profile.phone = document.getElementById('phone').value;
            profile.birthDate = document.getElementById('birthDate').value;
            profile.gender = document.getElementById('gender').value;
            profile.province = document.getElementById('province').value;
            profile.address = document.getElementById('address').value;

            Storage.set('userProfile', profile);

            // Update user name
            const user = Auth.getCurrentUser();
            user.name = profile.fullName;
            Auth.updateUser(user);

            document.getElementById('profileName').textContent = profile.fullName;
            
            App.showToast('اطلاعات شخصی با موفقیت ذخیره شد', 'success');
        });

        // Password Change Form
        document.getElementById('passwordChangeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            if (newPassword !== confirmPassword) {
                App.showToast('رمز عبور جدید و تکرار آن یکسان نیستند', 'error');
                return;
            }

            if (newPassword.length < 6) {
                App.showToast('رمز عبور باید حداقل 6 کاراکتر باشد', 'error');
                return;
            }

            // In a real app, you would verify the current password
            const user = Auth.getCurrentUser();
            user.password = newPassword;
            Auth.updateUser(user);

            App.showToast('رمز عبور با موفقیت تغییر کرد', 'success');
            this.reset();
        });

        // Business Info Form
        document.getElementById('businessInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const profile = Storage.get('userProfile') || {};
            profile.businessName = document.getElementById('businessName').value;
            profile.businessType = document.getElementById('businessType').value;
            profile.registrationNumber = document.getElementById('registrationNumber').value;
            profile.economicCode = document.getElementById('economicCode').value;
            profile.businessAddress = document.getElementById('businessAddress').value;
            profile.businessPhone = document.getElementById('businessPhone').value;
            profile.businessWebsite = document.getElementById('businessWebsite').value;

            Storage.set('userProfile', profile);
            App.showToast('اطلاعات کسب‌وکار با موفقیت ذخیره شد', 'success');
        });

        // Notification Settings Form
        document.getElementById('notificationSettings').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const notifications = {
                emailOrders: document.getElementById('emailOrders').checked,
                emailMarketing: document.getElementById('emailMarketing').checked,
                emailNews: document.getElementById('emailNews').checked,
                smsImportant: document.getElementById('smsImportant').checked,
                smsPayments: document.getElementById('smsPayments').checked
            };

            Storage.set('notificationSettings', notifications);
            App.showToast('تنظیمات اعلان‌ها ذخیره شد', 'success');
        });

        // Avatar Upload
        document.getElementById('avatarInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profileImage').src = e.target.result;
                    
                    const profile = Storage.get('userProfile') || {};
                    profile.profileImage = e.target.result;
                    Storage.set('userProfile', profile);

                    App.showToast('تصویر پروفایل بروزرسانی شد', 'success');
                };
                reader.readAsDataURL(file);
            }
        });

        function enable2FA() {
            alert('احراز هویت دو مرحله‌ای به زودی فعال می‌شود');
        }

        function logout() {
            Auth.logout();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
